# История изменений:

#### v5.0.0:
#### закрыта critical уязвимость сервиса, фронт с react-router
* fix: закрыт доступ к бд снаружи докера
* fix: исправлены несколько багов на фронте и в логике работы с дампами
* fix: исправлен тестовый db-репозиторий с моком IQueryable
* upd: обновлены версии зависимостей
* upd: изменена структура проекта 
  - добавлены скрипты для npm
  - проект фронта убран из решения, редуцирован до файлов и разложен по виртуальным папкам (временный вариант)
* upd: начата чистка кода и изменение именований, в т.ч. контекста EF
* upd: добавлено использование SQLite для запуска интеграционных тестов и пример интеграционника
* ci: добавлен пробный пайплайн для прогона билда и тестов под .NET

#### v5.1.0
#### настройка локальной и удаленной разработки: подготовка CI/CD
* fix: фронт переработан для разработки с Vite 10.2.4 под Node 21.5.0 - npm 10.2.4 - React 17.0.0
  - время билда, количество зависимостей и артефактов сократилось на порядок
  - сборка проверена на младших версиях Node (18.19.0, 20.10.0)
* fix: поправлено использование кук совместно с CORS - модифицируется SameSite для соответсвия [**draft-west-cookie-incrementalism-00**](https://datatracker.ietf.org/doc/html/draft-west-cookie-incrementalism-00)
* upd: добавлен докерфайл для билда образа .NET + React
* upd: добавлен лаунчер среды разработки для JS (управление dev-сервером и браузером)
* ci: добавлен пробный пайплайн для прогона билда под Node.JS
* ci: добавлен пробный пайплайн для прогона билда образа сервиса с фронтом
* ci: добавлен пробный пайплайн для публикации докер-образа в GitHub Registry
* ci: тк на CI внутри билда .NET стал запускаться npm build, пререлизный JavaScript.Sdk был заменен на NET.Sdk и esproj исрправлен на csproj
* ci: для .NET использован базовый образ alpine, размер итогового образа сокращен в два раза
* cd: добавлен пробный пайплайн деплоя на удалённый сервер
* cd: добавлен пробный пайплайн для развертывания в кластере kubernetes k3s и манифесты для сервиса и mysql (в процессе проверки)

#### v5.1.1
#### настройка SSL
* fix: отключена модификация cookie для prod
* upd: https ready: изменен манифест ingress для поддержи DV SSL сертификата  
  kubectl create secret tls secret-tls --key=... --cert=...

#### v5.1.2
#### публикация API и переименование полей бд
* upd: переименованы файлы GitHub CI/CD
* upd: переименованы файлы манифестов K3S
* upd: проекты очищены от лишних комментариев
* upd: добавлены summary
* upd: исправлена структура проекта
* upd: отредактировано и опубликовано API
* upd: переименованы поля бд и дампа

#### v5.2.0
#### подъём версий
* upd: .NET8 + dockerfile
* upd: React 18 + Router 6
* upd: добавлен тестовый фреймворк для React: Vitest 1.2.2
* upd: запуск JS тестов на CI
* fix: подняты версии раннеров и SQLite (баг)
* fix: разделена конфигурация Vite для тестов и разработки

#### v5.2.x
#### клиент: правки по техдолгу
* 5.2.1 upd: конкретизированы типы TS
* 5.2.1 upd: компоненты клиента переписаны на функциональные
* 5.2.2 upd: переработанный глобальный стейт поставляется через контекст
* 5.2.2 upd: внешний стейт упрощен и разделен на recovery и common, компоненты разделены по файлам
* 5.2.3 upd: убраны стейт-машины из комопнентов Catalog и Read
* 5.2.4 business: мёрж дампа + расширение textbox
* 5.2.5 business: дополнен функционал сохранности данных + security-апдейт js + тесты vitest
* 5.2.6
  * business: добавлена политика авторизации, увеличен размер текста в заметке
  * observability: добавлены метрики и рейтлимитер на техническую ручку server_url/metrics
  * observability: добавлен Serilog
  * observability: добавлена трассировка в консоль для Debug
  * fix: исправлены угрозы безопасности (npm-пакеты), исправлен функционал запуска dev-сервера
* 5.2.7 front: модальное диалоговое окно 
* 5.2.x upd: настройка доступа по ssl-сертификату для нового домена notefinder.ru
   * k3s: добавлены и протестированы k3s-конфиги traefik для доступа по ip и https-доступа с адреса notefinder.ru
   * ssl: crt-бандл использован без root-сертификата: notefinder.noroot.crt
* 5.2.9
  * css: адаптивная grid-вёрстка для двух размеров экрана
  * upd: контроллер update целиком убран под авторизацию
  * upd: при перезагрузке страницы авторизация проверяется на сервере и кэшируется в local storage
  * dbs: переход на Postgres: см [DEVLOG.md](src/Rsse.Data/DEVLOG.md)
  * test: интеграционные тесты в контейнерах локально и на пайплайне  
  * upd: добавлены ручки аплоада файла дампа и замены данных авторизации  
  * k3s: добавлен манифест на postgres  
* 5.2.9 security fix
  * fix: поставлен лимит на аплоад в 10МБ
  * fix: выгрузка дампов из рута закрыта под авторизацию, добавлена ручка даунлоада, расширение mysql-дампа заменено на .dump  
  * upd: дампы по умолчанию создаются для postgres, без применения DDL бд пересоздаётся средствами EF

#### v6.0.0 `на проверке`
#### NET9 | OTLP | рефакторинг API, архитектуры и тестов с code review
* `NET9` `React19` `alpine:3.21`
  * [сравнение тега k6.0.0 с последним релизом k5.2.9 в github](https://github.com/nicks219/RSSearchEngine/compare/k5.2.9...k6.0.0)
  * upd: NET9 | React19 | интеграционники с services: GitHub Actions | k3s PVC для сервиса 
  * upd: чистка sqlite файлов после локального запуска тестов
  * upd: для юнит-тестов используется мок AsyncQueryProvider из EFCore.Testing
  * k3s: билд self-contained под alpine:3.21 | глобализация отключена в csproj | используется для деплоя


* `рефакторинг` `develop/release/6.0.0-pre`
  * [сравнение ветки 6.0.0-pre с последним релизом k5.2.9 в github](https://github.com/nicks219/RSSearchEngine/compare/k5.2.9...6.0.0-preview)
  * рефакторинг времени жизни служб
  * рефакторинг функционала по слоям
  * рефакторинг тестов
  * upd: тяжелая для бд операция инициализации токенайзера теперь запускается строго однократно
  * upd: тесты в IDE теперь не ждут завершения очистки файлов, процесс очистки полностью отвязан
  * ci: pdb удаляются по флагу IsPublishing=true, локально остаются доступны  


* `рефакторинг` `develop/release/6.0.0-pre-1`
  * [сравнение ветки 6.0.0-pre-1 с 6.0.0-pre в github](https://github.com/nicks219/RSSearchEngine/compare/6.0.0-preview...6.0.0-pre-release-1)
  * err: `fix` copy предварительно не очищает базу и падает на constraint ключей
  * err: `fix` создание дампа для новой песни удаляет dump.zip (когда создаёт только файлы без архива)
  * upd: увеличение тестового покрытия 
  * upd: рефакторинг архитектуры проектов (функционал/dto по слоям, убран service locator)
  * upd: `fix` в манифест **rsse-app-deployment** добавлена ручка `system/version` на **liveness/readiness** пробы  


* `code-review` `develop/release/6.0.0-pre-2`
  * [сравнение ветки 6.0.0-pre-2 с 6.0.0-pre-1 в github](https://github.com/nicks219/RSSearchEngine/compare/6.0.0-pre-release-1...6.0.0-pre-release-2)
  * upd: рефакторинг API, изменены пути и HTTP глаголы
  * upd: из констант путей сервиса локально на билде генерируются константы путей для клиента (необходимо коммитать)
  * `code-review` upd: удаление лишних **nullable** в контексте
  * upd: рефакторинг зависимостей контроллеров, управление жизненным циклом сервисов бизнес-логики через DI
  * upd: рефакторинг IDataRepository (все методы сделаны асинхронными и без IQueryable)
  * upd: рефакторинг dto и code-style
  * upd: рефакторинг tokenizer service
  * upd: написать тест на UpdateCredos (в CatalogRepository было перепутано поле old/new)
  * upd: поправить summary в Rsse.Data
  * upd: поправить summary в Rsse.Service
  * `d0.0.0` upd: выделить domain в отдельный проект, дополнить билд докера с учетом изменений
  * upd: выделить генератор констант в отдельный проект для корректного запуска под Visual Studio и Rider
  * upd: удалить очистку контекстов из имплементаций IDataRepository тк репозитории не являются владельцами контекстов бд
  * upd: удалить закрытие соединений до бд тк они закрываются на очистке
  * upd: доработать маппинг
  * upd: убрать анонимные типы из ответов контроллеров
  * upd: скроллить в клиенте результат поиска до показа верней строчки
  * upd: сделать более информативной обработку ошибок
  * upd: сделать DatabaseInitializer асинхронным
  * upd: пробросить токены отмены через функционал
  * upd: обрабатывать исключения централизованно
  * upd: корректная отмена миграций
  * upd: задействовать NpgSqlDataSource и MySqlDataSource
  * `d0.0.1` upd: рассмотреть возможность заменить в Rsse.Data конкретные зависимости на абстрактные


* `OTLP` `develop/release/6.0.0-pre-3` `latest`
  * [сравнение ветки 6.0.0-pre-3 с 6.0.0-pre-2 в github](https://github.com/nicks219/RSSearchEngine/compare/6.0.0-pre-release-2...6.0.0-pre-release-3)
  * [информация про включение самодиагностики в OpenTelemetry SDK NET](https://www.nuget.org/packages/OpenTelemetry#self-diagnostics)
  * [информация по созданию k3s ресурсов для проекта](.common/scripts.k3s.bash)

  * upd: добавить манифест для скрейпа и экспорта метрик через **otel collector** в **Grafana Cloud**
  * upd: добавить хелсчеки (трафик можно принимать при завершения инициализации)
  * upd: выделить тесты на реальных бд в отдельный проект
  * upd: заменить EnsureCreated при инициализации на SQL
  * upd: закрыть параметры ручек проверкой required (для Rider версия open api в json отредактирована)
  * upd: поставлять observability в OTLP формате и экспортировать из кластера в Grafana Cloud
    * otlp-экспортеры отключаются переменной `ASPNETCORE_OTLP_EXPORTERS_DISABLE`
  * upd: `k6.0.0` `master` манифесты k3s обновлены до *.v2.yml
  * upd: выбор алгоритма случайной заметки | теги ci/cd | кастомизация манифестов
  * upd: бенчмарки токенайзер vs Lucene
  * fix: возможность билда отдельного проекта (замена переменной MSBuild $SolutionDir)
  * fix: убрано создание лишних папок на билде по имени платформы Rider/Visual Studio
  * upd: выделение логики токенайзера в слой Domain
  * upd: к проекту с бенчмарками добавлен хелпер для профилирования
  * upd: `code-review` оптимизировать **reduced**/**extended** процессоры, используя профилирование:
    * до оптимизаций: 50 итераций | ~ время на итерацию: 0.1034 сек | ~ общая память: 5.741 Mb | потребление линейно зависит от количества данных
    * после оптимизаций: 50 итераций | ~ время на итерацию: 0.0437 сек | ~ общая память: 1.030 Mb
  * upd: `code-review` добавить обёртку над токенами, векторами и идентификаторами заметок в токенизаторе
  * upd: `code-review` добавить инвертированный индекс. Не готов для прома, в данной версии допускается использование только на разработке
  * upd: исключаем роут `/system/*` из трассировки

---
  * [ ] попробовать на CI использовать кэш NuGet и параллельный запуск (если поддерживается)
  * [ ] todo: выпустить релиз `6.0.0` в **GitHub**
---
